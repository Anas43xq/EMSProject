import{a as y,s as d,j as e}from"./index-BBL5zgFY.js";import{r as l}from"./vendor-5bkAA5gm.js";import{d as o,c as u,C as f,g as b}from"./lucide-cejH3fEv.js";import"./pdf-BwXo9bY9.js";import"./supabase-CQnWzhEg.js";function _(){const[c,m]=l.useState([]),[x,p]=l.useState(!0),{user:s}=y(),[r,h]=l.useState(new Date().toISOString().split("T")[0]);l.useEffect(()=>{i()},[s,r]);const i=async()=>{try{let t=d.from("attendance").select(`
          *,
          employees (
            first_name,
            last_name,
            employee_number
          )
        `).eq("date",r).order("created_at",{ascending:!1});(s==null?void 0:s.role)==="employee"&&(s!=null&&s.employeeId)&&(t=t.eq("employee_id",s.employeeId));const{data:n,error:a}=await t;if(a)throw a;m(n||[])}catch(t){console.error("Error loading attendance:",t)}finally{p(!1)}},g=async()=>{if(s!=null&&s.employeeId)try{const n=new Date().toTimeString().split(" ")[0].substring(0,5),{error:a}=await d.from("attendance").insert({employee_id:s.employeeId,date:r,check_in:n,status:"present"});if(a)throw a;i()}catch(t){console.error("Error marking attendance:",t)}};return x?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-900"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Attendance"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Track daily attendance and working hours"})]}),(s==null?void 0:s.role)==="employee"&&e.jsxs("button",{onClick:g,className:"flex items-center space-x-2 bg-blue-900 text-white px-4 py-2 rounded-lg hover:bg-blue-800 transition-colors",children:[e.jsx(o,{className:"w-5 h-5"}),e.jsx("span",{children:"Mark Attendance"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsx(u,{className:"w-5 h-5 text-gray-600"}),e.jsx("input",{type:"date",value:r,onChange:t=>h(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"space-y-4",children:c.map(t=>{var n,a;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${t.status==="present"?"bg-green-100":t.status==="late"?"bg-yellow-100":t.status==="absent"?"bg-red-100":"bg-gray-100"}`,children:t.status==="present"?e.jsx(f,{className:"w-6 h-6 text-green-900"}):t.status==="absent"?e.jsx(b,{className:"w-6 h-6 text-red-900"}):e.jsx(o,{className:"w-6 h-6 text-yellow-900"})}),e.jsxs("div",{children:[(s==null?void 0:s.role)!=="employee"&&e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[(n=t.employees)==null?void 0:n.first_name," ",(a=t.employees)==null?void 0:a.last_name]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["Check In: ",t.check_in||"N/A"]}),e.jsxs("span",{children:["Check Out: ",t.check_out||"N/A"]})]}),t.notes&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t.notes})]})]}),e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${t.status==="present"?"bg-green-100 text-green-800":t.status==="late"?"bg-yellow-100 text-yellow-800":t.status==="absent"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t.status})]})},t.id)})}),c.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No attendance records for this date"})})]})]})}export{_ as default};
