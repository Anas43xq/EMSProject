import{a as k,u as D,s as x,j as e}from"./index-BBL5zgFY.js";import{r as o}from"./vendor-5bkAA5gm.js";import{T as b,s as E,X as R}from"./lucide-cejH3fEv.js";import"./pdf-BwXo9bY9.js";import"./supabase-CQnWzhEg.js";function F(){const[p,y]=o.useState([]),[v,j]=o.useState(!0),[w,i]=o.useState(!1),[u,g]=o.useState(!1),[N,_]=o.useState([]),{user:a}=k(),{showNotification:d}=D(),[r,h]=o.useState({employee_id:"",review_period:"",review_date:new Date().toISOString().split("T")[0],overall_rating:3,goals:"",achievements:"",areas_of_improvement:"",comments:"",status:"draft"});o.useEffect(()=>{f(),((a==null?void 0:a.role)==="admin"||(a==null?void 0:a.role)==="hr")&&S()},[a]);const f=async()=>{try{let s=x.from("performance_reviews").select(`
          *,
          employees!employee_id (
            first_name,
            last_name,
            employee_number
          )
        `).order("review_date",{ascending:!1});(a==null?void 0:a.role)==="employee"&&(a!=null&&a.employeeId)&&(s=s.eq("employee_id",a.employeeId));const{data:t,error:l}=await s;if(l)throw l;y(t||[])}catch(s){console.error("Error loading reviews:",s),d("error","Failed to load reviews")}finally{j(!1)}},S=async()=>{try{const{data:s,error:t}=await x.from("employees").select("id, first_name, last_name, employee_number").eq("status","active").order("last_name");if(t)throw t;_(s||[])}catch(s){console.error("Error loading employees:",s)}},n=s=>{const{name:t,value:l}=s.target;h(c=>({...c,[t]:t==="overall_rating"?parseInt(l):l}))},C=async s=>{if(s.preventDefault(),!r.employee_id||!r.review_period){d("error","Please fill in all required fields");return}g(!0);try{const t=r.goals.split(`
`).filter(m=>m.trim()).map(m=>({goal:m.trim()})),l={employee_id:r.employee_id,reviewer_id:a==null?void 0:a.id,review_period:r.review_period,review_date:r.review_date,overall_rating:r.overall_rating,goals:t,achievements:r.achievements,areas_of_improvement:r.areas_of_improvement,comments:r.comments,status:r.status},{error:c}=await x.from("performance_reviews").insert(l);if(c)throw c;d("success","Performance review created successfully"),i(!1),h({employee_id:"",review_period:"",review_date:new Date().toISOString().split("T")[0],overall_rating:3,goals:"",achievements:"",areas_of_improvement:"",comments:"",status:"draft"}),f()}catch(t){console.error("Error creating review:",t),d("error",t.message||"Failed to create review")}finally{g(!1)}};return v?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-900"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Performance Management"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Track performance reviews and goals"})]}),((a==null?void 0:a.role)==="admin"||(a==null?void 0:a.role)==="hr")&&e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center space-x-2 bg-blue-900 text-white px-4 py-2 rounded-lg hover:bg-blue-800 transition-colors",children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{children:"New Review"})]})]}),e.jsxs("div",{className:"space-y-6",children:[p.map(s=>{var t,l;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[(a==null?void 0:a.role)!=="employee"&&e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:[(t=s.employees)==null?void 0:t.first_name," ",(l=s.employees)==null?void 0:l.last_name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Review Period: ",s.review_period]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Date: ",new Date(s.review_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.overall_rating&&e.jsxs("div",{className:"flex items-center space-x-1 bg-yellow-100 px-3 py-1 rounded-full",children:[e.jsx(E,{className:"w-4 h-4 text-yellow-600 fill-yellow-600"}),e.jsxs("span",{className:"text-sm font-medium text-yellow-900",children:[s.overall_rating,"/5"]})]}),e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="submitted"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s.status})]})]}),e.jsxs("div",{className:"space-y-4",children:[s.achievements&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"Achievements"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.achievements})]}),s.areas_of_improvement&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"Areas of Improvement"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.areas_of_improvement})]}),s.comments&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"Comments"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.comments})]})]})]},s.id)}),p.length===0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No performance reviews found"})]})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"New Performance Review"}),e.jsx("button",{onClick:()=>i(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(R,{className:"w-6 h-6 text-gray-600"})})]}),e.jsxs("form",{onSubmit:C,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Employee ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"employee_id",value:r.employee_id,onChange:n,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select Employee"}),N.map(s=>e.jsxs("option",{value:s.id,children:[s.first_name," ",s.last_name," (",s.employee_number,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Review Period ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"review_period",value:r.review_period,onChange:n,placeholder:"e.g., Q1 2026, Annual 2026",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Review Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"review_date",value:r.review_date,onChange:n,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Overall Rating: ",r.overall_rating,"/5"]}),e.jsx("input",{type:"range",name:"overall_rating",min:"1",max:"5",value:r.overall_rating,onChange:n,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"Needs Improvement"}),e.jsx("span",{children:"Excellent"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Goals (one per line)"}),e.jsx("textarea",{name:"goals",value:r.goals,onChange:n,rows:3,placeholder:"Enter goals, one per line",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Achievements"}),e.jsx("textarea",{name:"achievements",value:r.achievements,onChange:n,rows:3,placeholder:"Describe key achievements and contributions",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Areas for Improvement"}),e.jsx("textarea",{name:"areas_of_improvement",value:r.areas_of_improvement,onChange:n,rows:3,placeholder:"Identify areas where improvement is needed",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Comments"}),e.jsx("textarea",{name:"comments",value:r.comments,onChange:n,rows:3,placeholder:"Any additional feedback or notes",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{name:"status",value:r.status,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"submitted",children:"Submitted"}),e.jsx("option",{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:"flex items-center space-x-2 bg-blue-900 text-white px-6 py-2 rounded-lg hover:bg-blue-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Saving..."})]}):e.jsx("span",{children:"Create Review"})})]})]})]})})]})}export{F as default};
